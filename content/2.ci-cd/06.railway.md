---
title: D√©ploiement sur Railway
description: 'D√©ployez automatiquement votre API Node.js + Express + Prisma sur Railway'
icon: mdi:train
---

## Qu'est-ce que Railway ?

**Railway** est une plateforme de d√©ploiement moderne qui permet de d√©ployer des applications web, des APIs et des bases de donn√©es en quelques clics. C'est une alternative simple √† Heroku, Vercel ou AWS.

### Avantages de Railway

- :icon{name="i-heroicons-check-circle" class="text-green-500"} **Gratuit pour d√©buter** : 5$ de cr√©dit gratuit par mois (suffisant pour de petits projets)
- :icon{name="i-heroicons-check-circle" class="text-green-500"} **D√©ploiement automatique** : Connect√© √† GitHub, d√©ploie √† chaque push
- :icon{name="i-heroicons-check-circle" class="text-green-500"} **Base de donn√©es int√©gr√©e** : PostgreSQL, MySQL, Redis, MongoDB
- :icon{name="i-heroicons-check-circle" class="text-green-500"} **Variables d'environnement** : Gestion simple et s√©curis√©e
- :icon{name="i-heroicons-check-circle" class="text-green-500"} **Logs en temps r√©el** : D√©bogage facile
- :icon{name="i-heroicons-check-circle" class="text-green-500"} **Domaine gratuit** : Sous-domaine `.railway.app`

## Cr√©er un compte Railway

1. Allez sur [railway.app](https://railway.app)
2. Cliquez sur **Login**
3. Connectez-vous avec **GitHub**
4. Autorisez Railway √† acc√©der √† vos repositories

Railway est maintenant connect√© √† votre compte GitHub ! üéâ

## Pr√©parer votre projet

Avant de d√©ployer, assurez-vous que votre projet contient :

### 1. Script de d√©marrage

Dans votre `package.json`, ajoutez un script `start` :

```json
{
  "scripts": {
    "dev": "tsx watch ./src/index.ts",
    "build": "tsc",
    "start": "node ./dist/index.js",
    "typecheck": "tsc --noEmit",
    "lint": "eslint .",
    "test": "vitest run"
  }
}
```

**Important** :

- `build` : Compile TypeScript en JavaScript
- `start` : Lance l'application compil√©e (utilis√© par Railway)

### 2. Configuration du port

Railway assigne un port dynamique via la variable d'environnement `PORT`. Modifiez votre serveur Express :

```typescript
const PORT = process.env.PORT || 3000

app.listen(PORT, () => {
  console.log(`Server running on port ${PORT}`)
})
```

### 3. Fichier `.gitignore`

Assurez-vous d'ignorer les fichiers inutiles :

```
node_modules
dist
.env
.env.local
coverage
```

### 4. Configuration Prisma

Votre `schema.prisma` doit utiliser une variable d'environnement pour l'URL de la base de donn√©es :

```prisma
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}
```

## Cr√©er un projet sur Railway

### 1. Nouveau projet

1. Connectez-vous sur [railway.app](https://railway.app)
2. Cliquez sur **New Project**
3. S√©lectionnez **Deploy from GitHub repo**
4. Choisissez votre repository

### 2. Ajouter une base de donn√©es PostgreSQL

1. Dans votre projet Railway, cliquez sur **New**
2. S√©lectionnez **Database** ‚Üí **Add PostgreSQL**
3. Railway cr√©e automatiquement une base de donn√©es

### 3. Lier la base de donn√©es √† votre service

Railway g√©n√®re automatiquement la variable `DATABASE_URL` et la rend disponible √† votre service. Vous n'avez rien √† configurer manuellement ! üéâ

### 4. Variables d'environnement

Ajoutez vos variables d'environnement dans **Variables** :

```
NODE_ENV=production
JWT_SECRET=votre-secret-de-production
```

**Important** : Ne commitez JAMAIS vos secrets sur GitHub. Utilisez Railway pour les g√©rer.

## Configurer le d√©ploiement

### 1. Build Command

Railway d√©tecte automatiquement les commandes, mais vous pouvez les personnaliser :

1. Allez dans **Settings** ‚Üí **Build**
2. **Build Command** : `npm run build`
3. **Start Command** : `npm start`

### 2. Migrations Prisma

Pour ex√©cuter les migrations automatiquement au d√©ploiement, ajoutez un script :

Dans `package.json` :

```json
{
  "scripts": {
    "build": "prisma generate && prisma migrate deploy && tsc",
    "start": "node ./dist/index.js"
  }
}
```

**Explication** :

- `prisma generate` : G√©n√®re le client Prisma
- `prisma migrate deploy` : Applique les migrations
- `tsc` : Compile TypeScript

### 3. Healthcheck (optionnel)

Ajoutez un endpoint de sant√© dans votre API :

```typescript
app.get('/health', (req, res) => {
  res.status(200).json({ status: 'ok' })
})
```

Railway v√©rifie automatiquement que votre service r√©pond.

## D√©ployer votre application

1. **Commit et push** votre code sur GitHub :

```bash
git add .
git commit -m "feat: prepare for Railway deployment"
git push origin main
```

2. **Railway d√©tecte automatiquement** le push et lance le d√©ploiement

3. **Observez les logs** dans Railway :
   - Onglet **Deployments** ‚Üí Dernier d√©ploiement
   - Logs en temps r√©el

4. **Attendez la fin** du build (quelques minutes)

5. **Votre API est en ligne** ! üöÄ

## Acc√©der √† votre API

### URL g√©n√©r√©e

Railway g√©n√®re une URL automatique : `https://your-project.railway.app`

1. Allez dans **Settings** ‚Üí **Networking**
2. Cliquez sur **Generate Domain**
3. Railway cr√©e un sous-domaine unique

### Tester votre API

```bash
curl https://your-project.railway.app/health
```

R√©ponse :

```json
{ "status": "ok" }
```

## D√©ploiement automatique (CD)

Avec Railway connect√© √† GitHub, chaque **push sur `main`** d√©clenche un d√©ploiement automatique.

### Workflow complet

1. D√©veloppeur cr√©e une branche ‚Üí `feat/new-feature`
2. D√©veloppeur push le code et ouvre une **Pull Request**
3. **GitHub Actions** ex√©cute les tests (CI) :icon{name="i-heroicons-check-circle" class="text-green-500"}
4. Revue de code approuv√©e :icon{name="i-heroicons-check-circle" class="text-green-500"}
5. Merge vers `main`
6. **Railway d√©ploie automatiquement** (CD) üöÄ
7. Application mise √† jour en production

C'est du **Continuous Deployment** complet ! üéâ

## Logs et monitoring

### Voir les logs

1. Allez dans votre projet Railway
2. Cliquez sur votre service
3. Onglet **Logs**

Vous verrez tous les logs en temps r√©el :

```
Server running on port 8080
Database connected
Listening on https://your-project.railway.app
```

### Red√©ployer manuellement

Si besoin, vous pouvez red√©ployer manuellement :

1. Onglet **Deployments**
2. Cliquez sur **‚Ä¢‚Ä¢‚Ä¢** ‚Üí **Redeploy**

## Seed de la base de donn√©es

Pour remplir votre base de donn√©es avec des donn√©es initiales :

### 1. Cr√©er un script seed

Cr√©ez `prisma/seed.ts` :

```typescript
import { PrismaClient } from '@prisma/client'

const prisma = new PrismaClient()

async function main() {
  console.log('Seeding database...')

  await prisma.user.createMany({
    data: [
      { email: 'alice@example.com', name: 'Alice' },
      { email: 'bob@example.com', name: 'Bob' },
    ],
  })

  console.log('Seeding completed!')
}

main()
  .catch((e) => {
    console.error(e)
    process.exit(1)
  })
  .finally(async () => {
    await prisma.$disconnect()
  })
```

### 2. Configurer le seed

Dans `package.json` :

```json
{
  "prisma": {
    "seed": "tsx prisma/seed.ts"
  }
}
```

### 3. Ex√©cuter le seed

Localement :

```bash
npx prisma db seed
```

Sur Railway, ex√©cutez via le terminal int√©gr√© :

1. **Settings** ‚Üí **Service** ‚Üí **Web Console**
2. Tapez : `npx prisma db seed`

## Variables d'environnement partag√©es

Si vous avez plusieurs services (API + Frontend), vous pouvez partager des variables :

1. Cr√©ez une **Shared Variable** :
   - **Settings** ‚Üí **Shared Variables**
   - Ajoutez `API_URL`, `JWT_SECRET`, etc.

2. R√©f√©rencez-la dans vos services :
   - Railway injecte automatiquement les variables partag√©es

## Domaine personnalis√©

Pour utiliser votre propre domaine (ex: `api.monsite.com`) :

1. **Settings** ‚Üí **Networking** ‚Üí **Custom Domain**
2. Ajoutez votre domaine : `api.monsite.com`
3. Railway vous donne un **enregistrement CNAME**
4. Ajoutez cet enregistrement dans votre DNS (chez votre registrar)
5. Attendez la propagation DNS (quelques minutes)

Votre API est maintenant accessible sur `https://api.monsite.com` ! üéâ

## Scaling et performances

### Plan gratuit

- **500 heures** d'ex√©cution par mois
- **100 Go** de bande passante
- **1 Go** de RAM

### Plan payant

Si vous d√©passez le plan gratuit, Railway facture √† l'usage :

- **$0.000463/min** (~$20/mois pour une app toujours active)
- RAM/CPU suppl√©mentaires disponibles

### Optimisation

Pour r√©duire les co√ªts :

- Activez **Sleep on idle** si l'app n'est pas utilis√©e 24/7
- Optimisez les requ√™tes de base de donn√©es
- Utilisez un cache (Redis) pour r√©duire la charge

## Rollback en cas de probl√®me

Si un d√©ploiement casse la production :

1. Allez dans **Deployments**
2. Trouvez le dernier d√©ploiement fonctionnel
3. Cliquez sur **‚Ä¢‚Ä¢‚Ä¢** ‚Üí **Redeploy**

Votre application revient √† l'√©tat pr√©c√©dent ! üîÑ

## R√©sum√©

| √âtape                    | Description                                 |
| ------------------------ | ------------------------------------------- |
| **Pr√©parer le projet**   | Scripts `build` et `start`, port dynamique  |
| **Cr√©er le projet**      | Deploy from GitHub repo                     |
| **Ajouter PostgreSQL**   | Base de donn√©es int√©gr√©e                    |
| **Variables d'env**      | `JWT_SECRET`, `NODE_ENV`, etc.              |
| **Migrations Prisma**    | Script `build` avec `prisma migrate deploy` |
| **D√©ploiement auto**     | Push sur `main` ‚Üí D√©ploiement automatique   |
| **Logs**                 | Monitoring en temps r√©el                    |
| **Domaine personnalis√©** | CNAME vers Railway                          |

## Workflow CI/CD complet

Voici le workflow de d√©veloppement professionnel complet que nous avons mis en place :

1. **D√©veloppement local** :
   - Code avec **ESLint + Prettier** pour la qualit√©
   - Commits avec **Conventional Commits**
   - Tests avec **Vitest**

2. **Pull Request** :
   - **GitHub Actions** ex√©cute les tests (CI)
   - **Branch protection** emp√™che le merge si les tests √©chouent
   - **Code review** obligatoire

3. **Merge vers `main`** :
   - **Railway d√©ploie automatiquement** (CD)
   - Application mise √† jour en production
   - Z√©ro downtime

4. **Monitoring** :
   - Logs en temps r√©el sur Railway
   - Rollback possible en un clic

Vous avez maintenant un processus de d√©veloppement **professionnel**, **automatis√©** et **fiable** ! üöÄüéâ

## Bonus : Preview Deployments

Railway peut cr√©er des **d√©ploiements de pr√©visualisation** pour chaque PR :

1. **Settings** ‚Üí **Service** ‚Üí **PR Deployments**
2. Activez **Create deployments for Pull Requests**

Chaque PR aura son propre environnement de test avec une URL unique ! Parfait pour tester les features avant de les merger.

---

Dans le prochain chapitre, nous verrons comment **booster votre productivit√©** avec l'IA et **Claude Code** !
