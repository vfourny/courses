---
title: Socket.IO
description: 'Découvrez les WebSockets avec Socket.IO pour créer des applications temps réel'
icon: simple-icons:socketdotio
---

## Introduction

Socket.IO est une bibliothèque qui permet de mettre en place une communication bidirectionnelle en temps réel entre un
client et un serveur. Contrairement aux requêtes HTTP classiques où le client doit toujours initier la communication,
les WebSockets permettent au serveur d'envoyer des données au client à tout moment.

Socket.IO est particulièrement utile pour :

- Les applications de chat en temps réel
- Les notifications en direct
- Les jeux multijoueurs
- Les tableaux de bord avec des données qui se mettent à jour automatiquement
- La collaboration en temps réel (comme Google Docs)

> **Remarque:** Socket.IO utilise WebSocket comme protocole principal, mais peut automatiquement basculer vers d'autres
> méthodes (long polling) si les WebSockets ne sont pas disponibles.

#### Installation

Pour utiliser Socket.IO, nous devons installer deux packages : un pour le serveur et un pour le client.

```bash
npm install socket.io
npm install --save-dev @types/socket.io
```

Si vous souhaitez utiliser le client dans un projet Node.js (par exemple pour des tests), vous pouvez aussi installer :

```bash
npm install socket.io-client
```

## Serveur de base

Commençons par créer un serveur Socket.IO simple. Socket.IO fonctionne en s'attachant à un serveur HTTP, ce qui signifie
qu'il peut coexister avec Express.

```typescript
import express from 'express'
import { createServer } from 'http'
import { Server } from 'socket.io'

const app = express()
const httpServer = createServer(app)
const io = new Server(httpServer, {
  cors: {
    origin: '*',
  },
})

const port = 3000

// Route Express classique
app.get('/', (req, res) => {
  res.send('Serveur Socket.IO actif')
})

// Écoute des connexions Socket.IO
io.on('connection', (socket) => {
  console.log("Un client s'est connecté:", socket.id)

  socket.on('disconnect', () => {
    console.log("Un client s'est déconnecté:", socket.id)
  })
})

httpServer.listen(port, () => {
  console.log(`Serveur démarré sur http://localhost:${port}`)
})
```

> **Important:** Nous utilisons `httpServer.listen()` et non `app.listen()` car Socket.IO a besoin du serveur HTTP natif
> pour fonctionner.

> **Remarque:** L'option `cors` permet d'autoriser les connexions depuis n'importe quelle origine. En production, vous
> devriez restreindre cela à vos domaines autorisés.

## Événements

Le principe de Socket.IO repose sur l'émission et la réception d'**événements**. Un événement a un nom et peut
transporter des données.

### Recevoir des événements du client

```typescript
io.on('connection', (socket) => {
  console.log('Nouvelle connexion:', socket.id)

  // Écoute d'un événement personnalisé appelé 'message'
  socket.on('message', (data) => {
    console.log('Message reçu:', data)
  })

  // Écoute d'un événement avec plusieurs paramètres
  socket.on('chat-message', (username, message) => {
    console.log(`${username}: ${message}`)
  })
})
```

### Envoyer des événements au client

```typescript
io.on('connection', (socket) => {
  // Envoyer un événement uniquement à ce client
  socket.emit('welcome', 'Bienvenue sur le serveur!')

  // Envoyer à tous les clients connectés
  io.emit('notification', "Un nouvel utilisateur s'est connecté")

  // Envoyer à tous les clients sauf celui-ci
  socket.broadcast.emit('user-joined', socket.id)

  socket.on('message', (data) => {
    // Renvoyer le message à tous les clients (y compris l'émetteur)
    io.emit('message', data)
  })
})
```

Les méthodes principales pour émettre des événements :

- `socket.emit()` : Envoie à ce client uniquement
- `io.emit()` : Envoie à tous les clients connectés
- `socket.broadcast.emit()` : Envoie à tous les clients sauf celui qui émet

## Client HTML

Voici un exemple simple de client HTML qui se connecte au serveur Socket.IO :

```html
<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Socket.IO Client</title>
  </head>
  <body>
    <h1>Chat Socket.IO</h1>

    <div id="messages"></div>

    <input type="text" id="messageInput" placeholder="Votre message..." />
    <button id="sendButton">Envoyer</button>

    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script>
      // Connexion au serveur
      const socket = io('http://localhost:3000')

      // Écoute de l'événement de connexion
      socket.on('connect', () => {
        console.log("Connecté au serveur avec l'ID:", socket.id)
      })

      // Écoute de l'événement 'welcome'
      socket.on('welcome', (message) => {
        console.log(message)
      })

      // Écoute des messages
      socket.on('message', (data) => {
        const messagesDiv = document.getElementById('messages')
        const messageElement = document.createElement('p')
        messageElement.textContent = data
        messagesDiv.appendChild(messageElement)
      })

      // Envoi d'un message
      document.getElementById('sendButton').addEventListener('click', () => {
        const input = document.getElementById('messageInput')
        const message = input.value

        if (message) {
          socket.emit('message', message)
          input.value = ''
        }
      })
    </script>
  </body>
</html>
```

> **Astuce:** Dans cet exemple, nous utilisons le CDN de Socket.IO pour le client. En production, vous pourriez vouloir
> l'installer via npm et le bundler avec votre application.

## Exemple complet : Chat simple

Voici un exemple complet d'application de chat utilisant Socket.IO avec TypeScript côté serveur.

### Serveur (server.ts)

```typescript
import express from 'express'
import { createServer } from 'http'
import { Server } from 'socket.io'
import path from 'path'

const app = express()
const httpServer = createServer(app)
const io = new Server(httpServer, {
  cors: {
    origin: '*',
  },
})

// Servir les fichiers statiques
app.use(express.static('public'))

// Liste des utilisateurs connectés
const users = new Map<string, string>()

io.on('connection', (socket) => {
  console.log(`Nouvelle connexion: ${socket.id}`)

  // Quand un utilisateur rejoint avec un pseudo
  socket.on('join', (username: string) => {
    users.set(socket.id, username)
    io.emit('user-joined', {
      username,
      userCount: users.size,
    })
    console.log(`${username} a rejoint le chat`)
  })

  // Quand un message est envoyé
  socket.on('chat-message', (message: string) => {
    const username = users.get(socket.id) || 'Anonyme'
    io.emit('chat-message', {
      username,
      message,
      timestamp: new Date().toISOString(),
    })
  })

  // Quand un utilisateur se déconnecte
  socket.on('disconnect', () => {
    const username = users.get(socket.id)
    if (username) {
      users.delete(socket.id)
      io.emit('user-left', {
        username,
        userCount: users.size,
      })
      console.log(`${username} a quitté le chat`)
    }
  })
})

const port = 3000
httpServer.listen(port, () => {
  console.log(`Serveur de chat démarré sur http://localhost:${port}`)
})
```

### Client (public/index.html)

```html
<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chat Socket.IO</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 600px;
        margin: 50px auto;
        padding: 20px;
      }

      #messages {
        height: 400px;
        overflow-y: auto;
        border: 1px solid #ccc;
        padding: 10px;
        margin-bottom: 10px;
      }

      .message {
        margin: 5px 0;
        padding: 5px;
      }

      .system-message {
        color: #666;
        font-style: italic;
      }

      #messageForm {
        display: flex;
        gap: 10px;
      }

      #messageInput {
        flex: 1;
        padding: 8px;
      }

      button {
        padding: 8px 16px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <h1>Chat Socket.IO</h1>
    <p>Utilisateurs connectés: <span id="userCount">0</span></p>

    <div id="messages"></div>

    <form id="messageForm">
      <input
        type="text"
        id="messageInput"
        placeholder="Votre message..."
        required
      />
      <button type="submit">Envoyer</button>
    </form>

    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script>
      const socket = io('http://localhost:3000')
      const messagesDiv = document.getElementById('messages')
      const messageForm = document.getElementById('messageForm')
      const messageInput = document.getElementById('messageInput')
      const userCountSpan = document.getElementById('userCount')

      // Demander le pseudo au démarrage
      const username = prompt('Entrez votre pseudo:') || 'Anonyme'
      socket.emit('join', username)

      // Fonction pour ajouter un message
      function addMessage(content, isSystem = false) {
        const messageElement = document.createElement('div')
        messageElement.className = isSystem
          ? 'message system-message'
          : 'message'
        messageElement.textContent = content
        messagesDiv.appendChild(messageElement)
        messagesDiv.scrollTop = messagesDiv.scrollHeight
      }

      // Événements Socket.IO
      socket.on('connect', () => {
        addMessage('Connecté au serveur', true)
      })

      socket.on('user-joined', (data) => {
        addMessage(`${data.username} a rejoint le chat`, true)
        userCountSpan.textContent = data.userCount
      })

      socket.on('user-left', (data) => {
        addMessage(`${data.username} a quitté le chat`, true)
        userCountSpan.textContent = data.userCount
      })

      socket.on('chat-message', (data) => {
        const time = new Date(data.timestamp).toLocaleTimeString()
        addMessage(`[${time}] ${data.username}: ${data.message}`)
      })

      // Envoi de message
      messageForm.addEventListener('submit', (e) => {
        e.preventDefault()
        const message = messageInput.value.trim()

        if (message) {
          socket.emit('chat-message', message)
          messageInput.value = ''
        }
      })
    </script>
  </body>
</html>
```

## Bonnes pratiques

### 1. Typage des événements

En TypeScript, vous pouvez typer vos événements pour plus de sécurité :

```typescript
interface ServerToClientEvents {
  'chat-message': (data: {
    username: string
    message: string
    timestamp: string
  }) => void
  'user-joined': (data: { username: string; userCount: number }) => void
  'user-left': (data: { username: string; userCount: number }) => void
}

interface ClientToServerEvents {
  join: (username: string) => void
  'chat-message': (message: string) => void
}

const io = new Server<ClientToServerEvents, ServerToClientEvents>(httpServer)
```

### 2. Gestion des erreurs

Il est important de gérer les erreurs de connexion :

```typescript
io.on('connection', (socket) => {
  socket.on('error', (error) => {
    console.error('Erreur socket:', error)
  })
})
```

### 3. Déconnexion propre

Pensez à nettoyer les ressources lors de la déconnexion :

```typescript
socket.on('disconnect', (reason) => {
  console.log('Déconnexion:', reason)
  // Nettoyer les données de l'utilisateur
  users.delete(socket.id)
})
```

> **Astuce:** Socket.IO gère automatiquement la reconnexion en cas de perte de connexion temporaire. Vous pouvez
> configurer ce comportement avec les options de connexion.
